<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | Location Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
</head>
<style>
    body {
        font-family: 'Kanit', sans-serif;
    }

    .modal {
        display: none;
        /* üî• ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å hidden ‡πÄ‡∏õ‡πá‡∏ô none */
        position: fixed;
        inset: 0;
        background-color: rgba(0, 0, 0, 0.5);
        overflow-y: auto;
        justify-content: center;
        align-items: center;
    }


    .modal-content {
        background-color: white;
        padding: 20px;
        border-radius: 10px;
        width: 90%;
        max-width: 500px;
        max-height: 90vh;
        overflow-y: auto;
    }

    .modal-buttons {
        display: flex;
        justify-content: center;
        /* ‡∏à‡∏±‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á */
        gap: 15px;
        /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏° */
        margin-top: 20px;
        /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏Ç‡∏≠‡∏á‡∏õ‡∏∏‡πà‡∏° */
    }

    .modal-buttons button {
        width: 100px;
        /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏´‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô */
        padding: 10px 15px;
        font-size: 16px;
        font-weight: bold;
        border-radius: 8px;
        border: none;
        cursor: pointer;
    }

    .btn-cancel {
        background-color: #6c757d;
        /* ‡∏™‡∏µ‡πÄ‡∏ó‡∏≤ */
        color: white;
    }

    .btn-cancel:hover {
        background-color: #5a6268;
    }

    .btn-delete {
        background-color: #dc3545;
        /* ‡∏™‡∏µ‡πÅ‡∏î‡∏á */
        color: white;
    }

    .btn-delete:hover {
        background-color: #c82333;
    }

    .sidebar {
        position: fixed;
        top: 0;
        left: 0;
        height: 100vh;
        width: 250px;
        background-color: #1F2937;
        color: white;
        box-shadow: 2px 0 5px rgba(0, 0, 0, 0.2);
    }

    .main-content {
        margin-left: 250px;
        width: calc(100% - 250px);
        /* ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö Sidebar */
    }
</style>

<body class="bg-gray-100">
    {% load static %}

    <aside class="sidebar flex flex-col">
        <div class="p-6 text-2xl font-bold flex items-center">
            <img src="{% static 'easypark/image/logo.png' %}" alt="Logo" class="h-8 mr-2">
            Admin Panel
        </div>
        <nav class="flex-1">
            <a href="{% url 'admin_dashboard' %}" class="block py-3 px-6 hover:bg-gray-700 flex items-center">
                üìä <span class="ml-2">Dashboard</span>
            </a>
            <a href="{% url 'user_management' %}" class="block py-3 px-6 hover:bg-gray-700 flex items-center">
                üë• <span class="ml-2">Users</span>
            </a>
            <!-- <a href="#" class="block py-3 px-6 hover:bg-gray-700 flex items-center">
                ‚öôÔ∏è <span class="ml-2">Settings</span>
            </a> -->
            <a href="{% url 'locations_management' %}" class="block py-3 px-6 hover:bg-gray-700 flex items-center">
                üìç <span class="ml-2">Locations</span>
            </a>
        </nav>
        <form action="{% url 'logout' %}" method="post" class="p-6">
            {% csrf_token %}
            <button type="submit" class="w-full bg-red-500 hover:bg-red-600 py-2 rounded-lg transition">üö™
                Logout</button>
        </form>
    </aside>

    <main class="main-content flex flex-col p-6">
        <header class="bg-white p-4 shadow flex justify-between items-center">
            <h1 class="text-xl font-bold">üìç Manage Locations</h1>
            <div class="flex items-center space-x-4">
                <button onclick="openAddLocationModal()"
                    class="bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg" type="button">‚ûï
                    ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</button>
            </div>
        </header>

        <section class="mt-6">
            <div class="bg-white p-4 rounded-lg shadow-md">
                <table class="w-full border-collapse table-auto">
                    <thead class="bg-gray-700 text-white">
                        <tr>
                            <th class="border p-2">ID</th>
                            <th class="border p-2">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</th>
                            <th class="border p-2">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="location-table">
                        {% for lo in locations %}
                        <tr id="row-{{ lo.id }}" class="bg-gray-100 hover:bg-gray-200 transition">
                            <td class="border p-2 text-center">{{ lo.id }}</td>
                            <td class="border p-2 text-center location-name">{{ lo.name }}</td>
                            <td class="border p-2 text-center">
                                <button class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded"
                                    onclick="openEditLocationModal('{{ lo.id }}')">
                                    ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                                </button>
                                <button onclick="openDeleteModal('{{ lo.id }}')"
                                    class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded">
                                    üóëÔ∏è ‡∏•‡∏ö
                                </button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>

                </table>
            </div>
        </section>
    </main>

    <!-- ‚úÖ Modal ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô -->
    <div id="notificationModal"
        class="modal hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-50">
        <div class="modal-content bg-white p-6 rounded-lg shadow-lg w-96 text-center">
            <h2 class="text-xl font-bold" id="modalTitle">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h2>
            <p id="modalMessage" class="mt-2 text-gray-700"></p>
            <button onclick="closeNotificationModal()"
                class="mt-4 bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded">
                ‡∏ï‡∏Å‡∏•‡∏á
            </button>
        </div>
    </div>

    <!-- Modal ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö -->
    <div id="confirmDeleteModal" class="modal fixed inset-0 flex items-center justify-center hidden">
        <div class="bg-white p-6 rounded-lg shadow-lg max-w-md">
            <h2 class="text-xl font-bold text-gray-800 mb-4">‚ö†Ô∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö</h2>
            <p class="text-gray-600 mb-4">‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ?</p>
            <div class="flex justify-center gap-4"> <!-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ -->
                <button onclick="closeDeleteModal()" class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded">
                    ‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                </button>
                <button id="confirmDeleteBtn" class="bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded">
                    üóëÔ∏è ‡∏•‡∏ö
                </button>
            </div>
        </div>
    </div>





    <!-- üìå Modal ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà -->
    <div id="addLocationModal" class="modal flex justify-center items-center hidden">
        <div class="modal-content w-96 p-6 rounded-lg shadow-lg">
            <h2 class="text-xl font-bold mb-4">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</h2>
            <form id="addLocationForm" method="post" action="/locations/add/" enctype="multipart/form-data">

                {% csrf_token %}

                <label class="block text-gray-700">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</label>
                <input type="text" id="locationName" name="name" class="w-full p-2 border rounded-lg mb-3">

                <label class="block text-gray-700">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
                <textarea id="description" name="description" class="w-full p-2 border rounded-lg mb-3"></textarea>

                <label class="block text-gray-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</label>
                <input type="number" id="totalSpots" name="total_spots" class="w-full p-2 border rounded-lg mb-3">

                <label class="block text-gray-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏î‡∏ß‡πà‡∏≤‡∏á</label>
                <input type="number" id="availableSpots" name="available_spots"
                    class="w-full p-2 border rounded-lg mb-3">

                <label class="block text-gray-700">Camera URL</label>
                <input type="url" id="cameraUrl" name="camera_url" class="w-full p-2 border rounded-lg mb-3">

                <label class="block text-gray-700">‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</label>
                <select id="locationOwner" name="owner" class="w-full p-2 border rounded-lg mb-3">
                    {% for user in users %}
                    <option value="{{ user.id }}">{{ user.username }}</option>
                    {% endfor %}
                </select>


                <label class="block text-gray-700">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û <span class="text-red-500">*</span></label>
                <input type="file" id="image" name="image" class="w-full p-2 border rounded-lg mb-1">
                <div id="image-error" class="text-red-500 text-sm mb-3 hidden">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</div>

                <div class="flex justify-end space-x-2 mt-4">
                    <button type="button" onclick="closeAddLocationModal()"
                        class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded">
                        ‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    </button>
                    <button type="submit" onclick="saveAddLocation(event)"
                        class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded">
                        üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                    </button>

                </div>
            </form>

        </div>
    </div>

    <div id="editLocationModal" class="modal flex justify-center items-center hidden">
        <div class="modal-content w-96 p-6 rounded-lg shadow-lg">
            <h2 class="text-xl font-bold mb-4">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</h2>

            <form id="editLocationForm" method="post" action="" enctype="multipart/form-data">
                {% csrf_token %}
                <input type="hidden" id="editLocationId">

                <label class="block text-gray-700">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</label>
                <input type="text" id="editLocationName" name="name" class="w-full p-2 border rounded-lg mb-3">

                <label class="block text-gray-700">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
                <textarea id="editDescription" name="description" class="w-full p-2 border rounded-lg mb-3"></textarea>

                <label class="block text-gray-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</label>
                <input type="number" id="editTotalSpots" name="total_spots" class="w-full p-2 border rounded-lg mb-3">

                <label class="block text-gray-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏î‡∏ß‡πà‡∏≤‡∏á</label>
                <input type="number" id="editAvailableSpots" name="available_spots"
                    class="w-full p-2 border rounded-lg mb-3">

                <label class="block text-gray-700">Camera URL</label>
                <input type="url" id="editCameraUrl" name="camera_url" class="w-full p-2 border rounded-lg mb-3">

                <label class="block text-gray-700">‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</label>
                <select id="editLocationOwner" name="owner" class="w-full p-2 border rounded-lg mb-3">
                    {% for user in users %}
                    <option value="{{ user.id }}">{{ user.username }}</option>
                    {% endfor %}
                </select>

                <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡πÄ‡∏î‡∏¥‡∏° -->
                <label class="block text-gray-700">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏î‡∏¥‡∏°</label>
                <div class="mb-3">
                    <img id="editCurrentImage" src="" alt="‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏î‡∏¥‡∏°" class="w-full h-40 object-cover rounded-lg">
                </div>

                <!-- ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏°‡πà -->
                <label class="block text-gray-700">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏°‡πà (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô)</label>
                <input type="file" id="editImage" name="image" accept="image/*"
                    class="w-full p-2 border rounded-lg mb-3">

                <div class="flex justify-end space-x-2 mt-4">
                    <button type="button" onclick="closeEditLocationModal()"
                        class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button type="submit" onclick="saveEditLocation(event)"
                        class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                </div>
            </form>
        </div>
    </div>






    <script>
        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏Ñ‡πâ‡∏î JavaScript ‡∏ô‡∏µ‡πâ‡∏ï‡πà‡∏≠‡∏à‡∏≤‡∏Å script ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
        document.addEventListener('DOMContentLoaded', function () {
            // ‡πÄ‡∏û‡∏¥‡πà‡∏° Event Listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà
            const addLocationForm = document.getElementById('addLocationForm');
            const imageInput = document.getElementById('image');
            const imageError = document.getElementById('image-error');

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô saveAddLocation
            window.saveAddLocation = function (event) {
                event.preventDefault();

                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                if (!imageInput.files || imageInput.files.length === 0) {
                    // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                    imageError.classList.remove('hidden');
                    return false;
                }

                // ‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå
                imageError.classList.add('hidden');

                // ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥
                const form = document.getElementById("addLocationForm");
                const formData = new FormData(form);

                fetch("/locations/add/", {
                    method: "POST",
                    body: formData,
                    credentials: "include"
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            showNotification("‚úÖ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
                            addTableRow(data.location);
                            clearAddLocationForm();
                            closeAddLocationModal();
                        } else {
                            showNotification("‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", data.error);
                        }
                    })
                    .catch(error => showNotification("‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "‡πÄ‡∏Å‡∏¥‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ç‡∏ì‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"));
            };

            // ‡πÄ‡∏û‡∏¥‡πà‡∏° Event Listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏ü‡∏•‡πå
            if (imageInput) {
                imageInput.addEventListener('change', function () {
                    if (this.files && this.files.length > 0) {
                        // ‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå
                        imageError.classList.add('hidden');
                    }
                });
            }
        });
        function clearAddLocationForm() {
            document.getElementById("locationName").value = "";
            document.getElementById("description").value = "";
            document.getElementById("totalSpots").value = "";
            document.getElementById("availableSpots").value = "";
            document.getElementById("cameraUrl").value = "";
            document.getElementById("locationOwner").selectedIndex = 0; // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏£‡∏Å
            document.getElementById("image").value = ""; // ‡∏•‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
        }

        function showNotification(title, message) {
            document.getElementById("modalTitle").textContent = title;
            document.getElementById("modalMessage").textContent = message;
            document.getElementById("notificationModal").classList.remove("hidden");
        }
        function closeNotificationModal() {
            document.getElementById("notificationModal").classList.add("hidden");
        }

        let deleteLocationId = null; // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤ locationId ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö

        function openDeleteModal(locationId) {
            deleteLocationId = locationId;
            document.getElementById("confirmDeleteModal").classList.remove("hidden");
        }

        function closeDeleteModal() {
            deleteLocationId = null;
            document.getElementById("confirmDeleteModal").classList.add("hidden");
        }

        document.getElementById("confirmDeleteBtn").addEventListener("click", function () {
            if (!deleteLocationId) return;

            console.log("üóëÔ∏è ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà ID:", deleteLocationId);

            fetch(`/locations/delete/${deleteLocationId}/`, {
                method: "DELETE",
                headers: {
                    "X-CSRFToken": getCSRFToken()
                }
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showNotification("‚úÖ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", "‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß");
                        const row = document.getElementById(`row-${deleteLocationId}`);
                        if (row) {
                            row.remove();
                        }
                        closeDeleteModal();
                    } else {
                        showNotification("‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", data.error);
                    }
                })
                .catch(error => showNotification("‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "‡πÄ‡∏Å‡∏¥‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ç‡∏ì‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"));
        });



        function addTableRow(location) {
            const tableBody = document.getElementById("location-table");

            // ‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ñ‡∏ß‡πÉ‡∏´‡∏°‡πà
            const newRow = document.createElement("tr");
            newRow.setAttribute("id", `row-${location.id}`);
            newRow.classList.add("bg-gray-100", "hover:bg-gray-200", "transition");

            // ‚úÖ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡πâ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå
            newRow.innerHTML = `
        <td class="border p-2 text-center">${location.id}</td>
        <td class="border p-2 text-center location-name">${location.name}</td>
        <td class="border p-2 text-center">
            <button class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded"
                onclick="openEditLocationModal('${location.id}')">
                ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
            </button>
            <button onclick="deleteLocation('${location.id}')"
                class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded">
                üóëÔ∏è ‡∏•‡∏ö
            </button>
        </td>
    `;

            // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ñ‡∏ß‡πÉ‡∏´‡∏°‡πà‡∏•‡∏á‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á
            tableBody.appendChild(newRow);
        }

        function saveAddLocation(event) {
            event.preventDefault();
            const form = document.getElementById("addLocationForm");
            const formData = new FormData(form);

            fetch("/locations/add/", {
                method: "POST",
                body: formData,
                credentials: "include"
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showNotification("‚úÖ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
                        addTableRow(data.location);
                        clearAddLocationForm(); // ‚úÖ ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                        closeAddLocationModal();
                    } else {
                        showNotification("‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", data.error);
                    }
                })
                .catch(error => showNotification("‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "‡πÄ‡∏Å‡∏¥‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ç‡∏ì‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"));
        }




        function openAddLocationModal() {
            console.log("üì¢ ‡πÄ‡∏õ‡∏¥‡∏î Modal ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà");
            const modal = document.getElementById("addLocationModal");
            if (modal) {
                modal.style.display = "flex";
            } else {
                console.error("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö Modal `addLocationModal`");
            }
        }

        function closeAddLocationModal() {
            document.getElementById("addLocationModal").style.display = "none";
        }


        function closeAddLocationModal() {
            document.getElementById("addLocationModal").style.display = "none";
        }

        function openEditLocationModal(locationId) {
            fetch(`/locations/get/${locationId}/`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // ‚úÖ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö‡∏ü‡∏¥‡∏•‡∏î‡πå‡πÉ‡∏ô Modal
                        document.getElementById("editLocationId").value = data.location.id;
                        document.getElementById("editLocationName").value = data.location.name || "";
                        document.getElementById("editDescription").value = data.location.description || "";
                        document.getElementById("editTotalSpots").value = data.location.total_spots || "";
                        document.getElementById("editAvailableSpots").value = data.location.available_spots || "";
                        document.getElementById("editCameraUrl").value = data.location.camera_url || "";
                        document.getElementById("editLocationOwner").value = data.location.owner || "";

                        // ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡πÄ‡∏î‡∏¥‡∏° ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏£‡∏π‡∏õ
                        const currentImage = document.getElementById("editCurrentImage");
                        if (data.location.image_url) {
                            currentImage.src = data.location.image_url;
                            currentImage.style.display = "block";
                        } else {
                            currentImage.style.display = "none"; // ‡∏ã‡πà‡∏≠‡∏ô‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ
                        }

                        // ‚úÖ ‡πÅ‡∏™‡∏î‡∏á Modal
                        document.getElementById("editLocationModal").style.display = "flex";
                    } else {
                        alert("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà");
                    }
                })
                .catch(error => console.error("‚ùå Error fetching location data:", error));
        }


        // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤
        function saveEditLocation(event) {
            event.preventDefault();

            const form = document.getElementById("editLocationForm");
            const formData = new FormData(form);
            const locationId = document.getElementById("editLocationId").value;

            fetch(`/dashboard/locations/edit/${locationId}/`, {
                method: "POST",
                body: formData,
                credentials: "include"
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showNotification("‚úÖ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", "‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
                        closeEditLocationModal();
                        updateTableRow(locationId);
                    } else {
                        showNotification("‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", data.error);
                    }
                })
                .catch(error => showNotification("‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "‡πÄ‡∏Å‡∏¥‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ç‡∏ì‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"));
        }




        // üöÄ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏ö‡∏ö Real-time
        function updateTableRow(locationId) {
            fetch(`/locations/get/${locationId}/`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const row = document.querySelector(`#row-${locationId}`);
                        if (row) {
                            row.querySelector(".location-name").innerText = data.location.name;
                        }
                    }
                })
                .catch(error => showNotification("‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ"));
        }




        // ‚úÖ ‡∏õ‡∏¥‡∏î Modal
        function closeEditLocationModal() {
            document.getElementById("editLocationModal").style.display = "none";
        }


        function openLocationModal(locationId = null) {
            if (locationId) {
                fetch(`/locations/get/${locationId}/`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            document.getElementById("modalTitle").textContent = "‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà";
                            document.getElementById("locationId").value = data.location.id;
                            document.getElementById("locationName").value = data.location.name || "";
                            document.getElementById("description").value = data.location.description || "";
                            document.getElementById("totalSpots").value = data.location.total_spots || "";
                            document.getElementById("availableSpots").value = data.location.available_spots || "";
                            document.getElementById("cameraUrl").value = data.location.camera_url || "";
                            document.getElementById("locationOwner").value = data.location.owner || "";
                        } else {
                            alert("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà");
                        }
                    });
            } else {
                document.getElementById("modalTitle").textContent = "‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà";
                document.getElementById("locationId").value = "";
                document.getElementById("locationName").value = "";
                document.getElementById("description").value = "";
                document.getElementById("totalSpots").value = "";
                document.getElementById("availableSpots").value = "";
                document.getElementById("cameraUrl").value = "";
                document.getElementById("locationOwner").selectedIndex = 0;
            }

            document.getElementById("locationModal").style.display = "flex";
        }

        function closeLocationModal() {
            document.getElementById("locationModal").style.display = "none";
        }

        function saveOrUpdateLocation() {
            const locationId = document.getElementById("locationId").value;
            const url = locationId ? `/locations/edit/${locationId}/` : "{% url 'admin_add_location' %}";




            const form = document.getElementById("locationForm");
            const formData = new FormData(form);


            formData.append("csrfmiddlewaretoken", getCSRFToken());
            formData.append("name", document.getElementById("locationName").value);
            formData.append("description", document.getElementById("description").value);
            formData.append("total_spots", document.getElementById("totalSpots").value);
            formData.append("available_spots", document.getElementById("availableSpots").value);
            formData.append("camera_url", document.getElementById("cameraUrl").value);
            formData.append("owner", document.getElementById("locationOwner").value);

            fetch(url, { method: "POST", body: formData })
                .then(() => location.reload());
        }

        function getCSRFToken() {
            const csrfInput = document.querySelector("#locationForm input[name=csrfmiddlewaretoken]");
            if (!csrfInput) {
                console.error("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö CSRF Token ‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°!");
                return "";
            }
            return csrfInput.value;
        }

    </script>
</body>

</html>